#!/usr/bin/env sh

# Helper functions for colors
print_red() { printf '\033[0;31m%s\033[0m\n' "$1"; }
print_green() { printf '\033[0;32m%s\033[0m\n' "$1"; }
print_yellow() { printf '\033[1;33m%s\033[0m\n' "$1"; }
print_blue() { printf '\033[0;34m%s\033[0m\n' "$1"; }

print_blue "üöÄ Running pre-push checks..."
echo ""

# Get current branch
current_branch=$(git rev-parse --abbrev-ref HEAD)

# Define valid branch name patterns
valid_patterns="^(feat|refactor|bugfix|fix|hotfix|release|chore|docs|ci)/"

# Check if branch follows naming convention
if ! echo "$current_branch" | grep -Eq "$valid_patterns"; then
  # Allow main, dev, and other permanent branches
  if echo "$current_branch" | grep -Eq "^(main|dev|develop|production)$"; then
    print_green "‚úÖ Pushing to permanent branch: $current_branch"
    echo ""
  else
    print_red "‚ùå Invalid branch name: '$current_branch'"
    echo ""
    print_yellow "Branch name does not follow naming conventions!"
    echo ""
    print_blue "üìù Valid branch naming patterns:"
    echo "  feature/<description>  - New features"
    echo "  feat/<description>     - New features (short)"
    echo "  bugfix/<description>   - Bug fixes"
    echo "  fix/<description>      - Bug fixes (short)"
    echo "  hotfix/<description>   - Emergency fixes"
    echo "  release/v<version>     - Release branches"
    echo "  chore/<description>    - Maintenance tasks"
    echo "  docs/<description>     - Documentation"
    echo "  ci/<description>       - CI/CD changes"
    echo "  refactor/<description> - Code refactoring"
    echo ""
    print_green "‚úÖ Valid examples:"
    echo "  feature/AUTH-123-user-login"
    echo "  feat/add-dark-mode"
    echo "  bugfix/fix-login-crash"
    echo "  fix/payment-validation"
    echo "  hotfix/v1.2.1-security-patch"
    echo "  release/v1.2.0"
    echo "  chore/update-dependencies"
    echo "  docs/api-documentation"
    echo "  ci/setup-github-actions"
    echo "  refactor/navbar-component"
    echo ""
    print_blue "üí° To rename your branch:"
    echo "  git branch -m $current_branch <new-valid-name>"
    echo ""
    print_blue "üí° To bypass (not recommended):"
    echo "  git push --no-verify"
    echo ""
    exit 1
  fi
fi

print_green "‚úÖ Branch name is valid: $current_branch"
echo ""
print_green "üöÄ Pushing to remote..."
echo ""