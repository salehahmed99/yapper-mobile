#!/usr/bin/env sh

msg_file=$1
msg=$(cat "$msg_file")

# Get current branch name
branch=$(git rev-parse --abbrev-ref HEAD 2>/dev/null)

# Helper functions for colors
print_red() { printf '\033[0;31m%s\033[0m\n' "$1"; }
print_green() { printf '\033[0;32m%s\033[0m\n' "$1"; }
print_yellow() { printf '\033[1;33m%s\033[0m\n' "$1"; }
print_blue() { printf '\033[0;34m%s\033[0m\n' "$1"; }

# Conventional commits validation
if ! echo "$msg" | grep -Eq "^(feat|fix|chore|docs|refactor|test|style|perf|ci|build|revert|release|hotfix)(\(.+\))?: .+"; then
  print_red "‚ùå Invalid commit message format!"
  echo ""
  print_blue "üìù Required format: <type>(<scope>): <description>"
  echo ""
  print_green "‚úÖ Valid types:"
  echo "  feat     - New feature"
  echo "  fix      - Bug fix"
  echo "  hotfix   - Emergency production fix"
  echo "  release  - Release preparation"
  echo "  refactor - Code refactoring"
  echo "  perf     - Performance improvement"
  echo "  test     - Adding/updating tests"
  echo "  docs     - Documentation changes"
  echo "  style    - Code style/formatting"
  echo "  chore    - Maintenance tasks"
  echo "  ci       - CI/CD changes"
  echo "  build    - Build system changes"
  echo "  revert   - Revert previous commit"
  echo ""
  print_green "üìö Examples:"
  echo "  feat(auth): add OAuth login support"
  echo "  fix(api): resolve timeout on large requests"
  echo "  hotfix(security): patch XSS vulnerability"
  echo "  docs: update installation instructions"
  echo "  refactor(utils): simplify date formatting"
  echo ""
  print_blue "üí° Tip: Use 'git commit --amend' to fix your commit message"
  echo ""
  exit 1
fi

# Success message
print_green "‚úÖ Commit message is valid!"
echo ""