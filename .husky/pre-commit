#!/usr/bin/env sh

# Helper functions for colors
print_red() { printf '\033[0;31m%s\033[0m\n' "$1"; }
print_green() { printf '\033[0;32m%s\033[0m\n' "$1"; }
print_yellow() { printf '\033[1;33m%s\033[0m\n' "$1"; }
print_blue() { printf '\033[0;34m%s\033[0m\n' "$1"; }

print_blue "ğŸ” Running pre-commit checks..."
echo ""

# Run lint-staged (ESLint + Prettier on staged files)
print_yellow "ğŸ“ Running lint-staged..."
npx lint-staged

if [ $? -ne 0 ]; then
  echo ""
  print_red "âŒ Lint-staged failed!"
  echo ""
  print_yellow "Common fixes:"
  echo "  â€¢ Run: npm run lint:fix"
  echo "  â€¢ Run: npm run format"
  echo "  â€¢ Fix remaining issues manually"
  echo ""
  print_blue "ğŸ’¡ To bypass (use sparingly):"
  echo "  git commit --no-verify"
  echo ""
  exit 1
fi

echo ""
print_green "âœ… Lint-staged passed!"
echo ""

# Run TypeScript type check
print_yellow "ğŸ” Running TypeScript check..."

npm run type-check

if [ $? -ne 0 ]; then
  echo ""
  print_red "âŒ TypeScript type check failed!"
  echo ""
  print_yellow "Fix type errors before committing"
  echo ""
  print_blue "ğŸ’¡ To bypass (use sparingly):"
  echo "  git commit --no-verify"
  echo ""
  exit 1
fi

echo ""
print_green "âœ… TypeScript check passed!"
echo ""

# Success!
echo ""
print_green "âœ¨ All pre-commit checks passed!"
print_green "âœ… Ready to commit"
echo ""